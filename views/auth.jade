//- views/auth.jade
extends layout

block content
  style.
    :root{
      --bg1:#0b1020; --bg2:#0d1326;
      --card:#0f172a; --glass:rgba(255,255,255,.06); --border:rgba(255,255,255,.12);
      --ring:#7dd3fc; --violet:#c084fc; --teal:#34d399; --amber:#f59e0b;
      --text:#e5e7eb; --muted:#9ca3af; --danger:#fca5a5;
      --radius:18px; --shadow:0 18px 50px rgba(0,0,0,.55);
      --ringGlow:0 0 0 6px rgba(125,211,252,.09);
      --grid: clamp(300px, 48vw, 620px);
    }
    body{
      margin:0;
      background:
        radial-gradient(80vmax 80vmax at 10% 10%, rgba(99,102,241,.12), transparent 40%),
        radial-gradient(70vmax 70vmax at 90% 20%, rgba(20,184,166,.10), transparent 35%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      color:var(--text);
      font-synthesis-weight:none;
    }
    .auth-wrap{max-width:1100px;margin:3rem auto;padding:0 1.25rem;}
    .shell{
      display:grid;grid-template-columns: 1fr var(--grid);gap:28px;
      align-items:stretch;
    }
    @media (max-width:980px){ .shell{grid-template-columns:1fr} .visual{order:2} .panel{order:1} }

    /* Left visual / brand */
    .visual{
      position:relative;
      min-height:520px;
      border:1px solid var(--border);
      border-radius:calc(var(--radius) + 6px);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      overflow:hidden;
      box-shadow:var(--shadow);
      isolation:isolate;
    }
    .visual::before{
      content:"";
      position:absolute; inset:-30% -20% auto auto;
      width:70vmin;height:70vmin; border-radius:50%;
      background: radial-gradient(closest-side, rgba(192,132,252,.18), transparent 70%);
      filter:blur(10px); z-index:-1;
      animation: float 12s ease-in-out infinite alternate;
    }
    @keyframes float{ to { transform: translate(-10px, 14px) scale(1.04);} }
    .brand{
      display:flex;align-items:center;gap:.75rem;padding:1.25rem 1.25rem 0 1.25rem;
    }
    .logo{
      inline-size:40px; block-size:40px; border-radius:12px;
      background:
        conic-gradient(from 0deg, #60a5fa, #34d399, #c084fc, #60a5fa);
      mask: radial-gradient(circle at 30% 30%, black 62%, transparent 63%) padding-box,
            linear-gradient(#000,#000) border-box;
      -webkit-mask-composite: xor; mask-composite: exclude;
      border:1px solid rgba(255,255,255,.25);
      box-shadow:0 0 0 6px rgba(255,255,255,.03);
    }
    .brand h1{font-size:1.1rem;margin:0;color:#dbeafe;font-weight:800;letter-spacing:.3px}
    .visual-copy{
      padding:2.25rem 1.5rem 1.5rem 1.5rem;
    }
    .kicker{
      display:inline-flex;align-items:center;gap:.5rem;
      font-size:.8rem;color:var(--muted);background:rgba(255,255,255,.05);
      border:1px solid var(--border); padding:.35rem .6rem; border-radius:999px;
    }
    .kicker .dot{width:6px;height:6px;border-radius:50%;background:var(--teal)}
    .visual h2{
      margin:.8rem 0 .5rem; font-size:2.1rem; line-height:1.15; letter-spacing:.2px;
    }
    .visual p{color:#cbd5e1;max-width:52ch;margin:0}
    .badges{
      display:flex;flex-wrap:wrap;gap:.6rem;margin-top:1rem;
    }
    .badge{
      padding:.38rem .6rem; border:1px dashed rgba(255,255,255,.18);
      border-radius:999px; font-size:.78rem; color:#d1d5db;
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    }
    .hintline{
      display:flex;align-items:center;gap:.5rem; margin-top:1.25rem; color:var(--muted);font-size:.92rem;
    }
    .hintline svg{opacity:.8}

    /* Right panel */
    .panel{
      display:flex;flex-direction:column;gap:18px;
    }
    .hero{
      padding:.75rem 0 .25rem;
      border-left:4px solid rgba(96,165,250,.45);
      padding-left:12px;
    }
    .hero h2{margin:.15rem 0 .35rem;font-size:1.8rem}
    .hero p{margin:0;color:var(--muted)}
    .grid{
      display:grid;grid-template-columns:1fr;gap:16px;
    }
    @media (min-width:560px){ .grid{grid-template-columns:1fr 1fr} }

    /* Cards & form */
    .form-card{
      position:relative;
      background:
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:1.25rem 1.25rem 1.35rem; backdrop-filter:blur(12px);
      transition:transform .25s ease, box-shadow .25s ease, border-color .25s ease;
    }
    .form-card:hover{ transform: translateY(-2px); border-color: rgba(125,211,252,.35); box-shadow: 0 20px 60px rgba(2,6,23,.55) }
    .form-card h3{margin:0 0 .9rem;font-size:1.1rem;letter-spacing:.2px}
    label{display:block;margin:.65rem 0 .35rem;font-weight:700;font-size:.92rem;color:#dbeafe}
    .field{position:relative;}
    input[type="email"],input[type="password"]{
      width:100%;padding:.78rem 1rem;border-radius:14px;border:1px solid var(--border);
      background:rgba(2,6,23,.55);color:var(--text);
      transition:border-color .2s ease, box-shadow .2s ease, background .2s ease;
    }
    input::placeholder{color:#94a3b8}
    input:focus{border-color:var(--ring);outline:none; box-shadow:var(--ringGlow)}
    .eye-btn{
      position:absolute;right:.55rem;top:50%;transform:translateY(-50%);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border); color:#cbd5e1;cursor:pointer; border-radius:10px;
      padding:.35rem .5rem; line-height:1; transition: border-color .2s ease, transform .15s ease;
    }
    .eye-btn:hover{ border-color: rgba(125,211,252,.35); transform: translateY(-50%) scale(1.03) }

    .btn{
      margin-top:1rem;width:100%;padding:.9rem 1rem;border-radius:14px;
      border:1px solid rgba(125,211,252,.45);
      background:
        linear-gradient(135deg, rgba(125,211,252,.18), rgba(192,132,252,.18)),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      color:var(--text);font-weight:800;cursor:pointer;letter-spacing:.2px;
      transition:filter .2s ease, transform .15s ease, box-shadow .2s ease;
      box-shadow: 0 10px 30px rgba(2,6,23,.4), inset 0 0 0 999px rgba(255,255,255,.01);
    }
    .btn:hover{ filter:brightness(1.1); box-shadow: 0 16px 40px rgba(2,6,23,.55) }
    .btn:active{ transform: translateY(1px) }

    .form-hint{display:flex;align-items:center;gap:.5rem;color:var(--muted);font-size:.9rem;margin-top:.65rem}
    .divider{
      height:1px;background:linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
      margin:.75rem 0 0;
    }
    .hint{
      color:var(--muted);font-size:.95rem;margin-top:.9rem;text-align:center
    }
    .status{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.4rem .7rem;border-radius:999px;border:1px solid var(--border);
      background:rgba(255,255,255,.04);font-size:.85rem;color:#bfdbfe
    }
    .status .pill{width:8px;height:8px;border-radius:50%;background:var(--amber)}

  .auth-wrap
    .shell
      .visual
        .brand
          .logo
          h1 TaskBoard
        .visual-copy
          span.kicker
            span.dot
            | Secure workspace access
          h2 Ship tasks faster with a calm, focused flow
          p Manage backlog, sprint work-in-progress, reviews, and doneâ€”without the noise. Lightweight auth, fast UI, and zero setup friction.
          .badges
            span.badge JWT Sessions
            span.badge CSRF-safe forms
            span.badge Minimal clicks
            span.badge Mobile ready
          .hintline
            svg(width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round")
              path(d="M12 20h9")
              path(d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z")
            span Personal accounts only. Your email is used for sign-in and notifications.

      .panel
        .hero
          h2 Auth Portal
          if user
            p
              | Welcome back,
              | &nbsp;
              span.status
                span.pill
                | #{user.email}
          else
            p Access your teamâ€™s task board by signing up or logging in.

        if !user
          .grid
            .form-card
              h3 Create an account
              .divider
              form#signupForm
                label(for='suEmail') Email
                .field
                  input#suEmail(type='email' placeholder='you@example.com' required)
                label(for='suPassword') Password
                .field
                  input#suPassword(type='password' placeholder='â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' required)
                  button.eye-btn(type='button' data-target='suPassword') ðŸ‘
                button.btn(type='submit') Create account
                .form-hint
                  svg(width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round")
                    path(d="M20 6L9 17l-5-5")
                  span Passwords are hashed. We never store plain text.
            .form-card
              h3 Welcome back
              .divider
              form#loginForm
                label(for='liEmail') Email
                .field
                  input#liEmail(type='email' placeholder='you@example.com' required)
                label(for='liPassword') Password
                .field
                  input#liPassword(type='password' placeholder='â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' required)
                  button.eye-btn(type='button' data-target='liPassword') ðŸ‘
                button.btn(type='submit') Log in
                .form-hint
                  svg(width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round")
                    circle(cx="12" cy="12" r="10")
                    path(d="M12 16v-4")
                    path(d="M12 8h.01")
                  span Trouble logging in? Contact your admin.

          p.hint After signing up or logging in, you will be taken to the Task Board.

        else
          .form-card
            h3 You are logged in
            .divider
            form(action="/users/logout" method="post")
              button.btn(type="submit") Log out
          p.hint Click logout to sign out and return to login/signup.

  if !user
    //- JS is intentionally untouched below
    script.
      (function () {
        const signupForm = document.getElementById('signupForm');
        const loginForm = document.getElementById('loginForm');
        const eyeBtns = document.querySelectorAll('.eye-btn');

        eyeBtns.forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const id = btn.getAttribute('data-target');
            const inp = document.getElementById(id);
            if(!inp) return;
            const isPw = inp.type === 'password';
            inp.type = isPw ? 'text' : 'password';
            btn.textContent = isPw ? 'ðŸ™ˆ' : 'ðŸ‘';
          });
        });

        signupForm.onsubmit = async (e) => {
          e.preventDefault();
          const email = document.getElementById('suEmail').value.trim();
          const password = document.getElementById('suPassword').value;
          const res = await fetch('/users/signup', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ email, password })
          });
          const data = await res.json();
          if (!res.ok) return alert(data.error || 'Sign up failed');
          alert('Signed up as ' + data.user.email);
          window.location.href = '/board';
        };

        loginForm.onsubmit = async (e) => {
          e.preventDefault();
          const email = document.getElementById('liEmail').value.trim();
          const password = document.getElementById('liPassword').value;
          const res = await fetch('/users/login', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ email, password })
          });
          const data = await res.json();
          if (!res.ok) return alert(data.error || 'Login failed');
          alert('Logged in as ' + data.user.email);
          window.location.href = '/board';
        };
      })();
